"use strict";angular.module("factoryng").factory("Firyng",["$q","$timeout","Yng","yngutils",function(a,b,c,d){return function(e,f,g){function h(a){return function(b){j(b).then(function(){return q.sortBy&&q.sortBy!==d.ASC&&q.sortIfNeeded(),q.bindModel(q.scope).then(a.resolve)})}}function i(a){var b=a.val();return b.$id=a.name(),b.$priority=a.getPriority(),b}function j(a){return b(function(){a.forEach(function(a){q.push(i(a))})})}function k(){s.on("child_added",q.applyFactory(m)),s.on("child_changed",q.applyFactory(n)),s.on("child_removed",q.applyFactory(o)),s.on("child_moved",q.applyFactory(p))}function l(a,b){var c=d.clone(b);delete c.$id,delete c.$priority,a.setWithPriority(c,b.$priority)}function m(a){q.createDoc(i(a)).then(function(){q.emit("uptodate")})}function n(a){q.updateDoc(i(a)).then(function(){q.emit("uptodate")})}function o(a){q.removeDoc(a.name()).then(function(){q.emit("uptodate")})}function p(a){q.moveDoc(i(a)).then(function(){q.emit("uptodate")})}var q=new c(e,f,g);q.copyApi(this);var r=null,s=null;this.provider=function(){return r},this.bound=function(){return r?!0:!1},this.bind=function(b){if(this.bound())return q.rebindModel(b);r=new Firebase(q.url),s=r.child(q.name),k();var c=a.defer();return q.scope=b,s.once("value",h(c)),c.promise},this.create=function(b){var c=s.push();return b.$id=c.name(),q.setPriorityIfNeeded(b),l(c,b),q.push(b),a.when(b)},this.update=function(b){return l(s.child(b.$id),b),q.set(b),a.when(b)},this.remove=function(b){var c=q.toId(b);s.child(c).remove();var d=q.remove(c);return a.when(d)},this.setPriority=function(b,c){var d=q.toId(b);s.child(d).setPriority(c),q.setProperty(d,"$priority",c);var e=q.get(d);return a.when(e)},this.destroy=function(b){if(b)return q.destroy();var c=a.defer();return s.remove(function(){q.destroy().then(c.resolve)}),c.promise}}}]);