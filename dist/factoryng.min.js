"use strict";function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(a){return"function"==typeof a}function isNumber(a){return"number"==typeof a}function isObject(a){return"object"==typeof a&&null!==a}function isUndefined(a){return void 0===a}if(angular.module("factoryng",[]).service("yngutils",["$q",function(a){this.ASC=1,this.DESC=2,this.replace=function(a,b){for(var c in a)this.notDefined(b[c])&&delete a[c];for(c in b)a[c]=b[c]},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isNumeric=function(a){return!isNaN(a)},this.notDefined=function(a){return"undefined"==typeof a},this.isFunction=function(a){return"function"==typeof a},this.clone=function(a){return JSON.parse(JSON.stringify(a))},this.copyFns=function(a,b,c){a.forEach(function(a){c[a]=function(){return b[a].apply(b,arguments)}})},this.forEach=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c,a)},this.doAndOnce=function(b,c,d){var e=a.defer(),f=a.defer();return d.once(c,function(){var a=arguments;return e.promise.then(function(b){f.resolve({action:b,event:a})})}),b().then(function(){return e.resolve(arguments),f.promise})},this.merge=function(a,b){var c,d={};if(a)for(c in a)d[c]=a[c];if(b)for(c in b)d[c]=b[c];return d},this.get=function(){if(arguments&&"undefined"!=typeof arguments[0]){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=arguments[b];if(null===a||"undefined"==typeof a[c])return;a=a[c]}return a}}}]),angular.module("factoryng").factory("Yng",["$timeout","$q","yngutils",function(a,b,c){var d=0,e=function(a,b,c){this.name=a,this.url=b,this.sortBy=c,this.model=[],this.map={},this.sorting=!1,this.scope=null,this.props=null};e.prototype=new EventEmitter;var f=100,g=function(a){return function(b,d){var e=b.$priority-d.$priority;return a===c.DESC?-e:e}};return e.prototype.sortIfNeeded=function(){this.sortBy&&this.model.sort(this.sortBy===c.ASC||this.sortBy===c.DESC?g(this.sortBy):this.sortBy)},e.prototype.sortSoonIfNeeded=function(){if(!this.sorting){this.sorting=!0;var b=this;a(function(){b.sortIfNeeded(),b.sorting=!1},f)}},e.prototype.get=function(a){return this.map[a]},e.prototype.at=function(a){return this.model[a]},e.prototype.set=function(a){this.exists(a.$id)&&c.replace(this.get(a.$id),a)},e.prototype.setProperty=function(a,b,c){this.map[a][b]=c},e.prototype.exists=function(a){return this.map[a]?!0:!1},e.prototype.push=function(a){this.exists(a.$id)||(this.map[a.$id]=a,this.model.push(a))},e.prototype.remove=function(a){var b=this.map[a];return b&&(this.model.splice(this.model.indexOf(b),1),delete this.map[a]),b},e.prototype.length=function(){return this.model.length},e.prototype.bindModel=function(b){var c=this;return a(function(){return c.scope=b,b[c.name]=c.model,c.model})},e.prototype.bound=function(){return this.scope&&this.scope[this.name]?!0:!1},e.prototype.applyFactory=function(a){var b=this;return function(){return a.apply(b,arguments)}},e.prototype.createDoc=function(b){var c=this;return a(function(){return c.push(b),c.emit("create",b),b})},e.prototype.updateDoc=function(b){var c=this;return a(function(){return c.set(b),c.emit("update",b),b})},e.prototype.removeDoc=function(b){var c=this;return a(function(){var a=c.toId(b),d=c.remove(a);return c.emit("remove",d),d})},e.prototype.moveDoc=function(b){var c=this;return a(function(){return c.get(b.$id).$priority!==b.$priority&&(c.set(b),c.sortSoonIfNeeded()),c.emit("move",b),b})},e.prototype.setPriorityIfNeeded=function(a){c.notDefined(a.$priority)&&(a.$priority=this.length())},e.prototype.toId=function(a){var b=c.isString(a)||c.isNumeric(a)?a:a.$id;if(c.notDefined(b))throw new Error("missing $id");return b},e.prototype.forEach=function(a,b){return this.model.forEach(a,b)},e.prototype.cleanup=function(){return b.when()},e.prototype.provider=function(){return null},e.prototype.destroy=function(){return this.removeAllListeners(),this.model=[],this.map={},b.when()},e.prototype.error=function(a){this.emit("error",a)},e.prototype.nextId=function(){return++d},e.prototype.properties=function(a){return"undefined"==typeof a?this.props:void(this.props=a)},e.prototype.copyApi=function(a){var b=["sortIfNeeded","sortSoonIfNeeded","get","at","set","setProperty","exists","push","remove","length","forEach","cleanup","provider","destroy","bound","properties","on","once","removeListener"];c.copyFns(b,this,a)},e}]),!module)var module={};module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(a){if(!isNumber(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},EventEmitter.prototype.emit=function(a){var b,c,d,e,f,g;if(this._events||(this._events={}),"error"===a&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],isUndefined(c))return!1;if(isFunction(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,e=new Array(d-1),f=1;d>f;f++)e[f-1]=arguments[f];c.apply(this,e)}else if(isObject(c)){for(d=arguments.length,e=new Array(d-1),f=1;d>f;f++)e[f-1]=arguments[f];for(g=c.slice(),d=g.length,f=0;d>f;f++)g[f].apply(this,e)}return!0},EventEmitter.prototype.addListener=function(a,b){var c;if(!isFunction(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,isFunction(b.listener)?b.listener:b),this._events[a]?isObject(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,isObject(this._events[a])&&!this._events[a].warned){var c;c=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!isFunction(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},EventEmitter.prototype.removeListener=function(a,b){var c,d,e,f;if(!isFunction(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],e=c.length,d=-1,c===b||isFunction(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(isObject(c)){for(f=e;f-->0;)if(c[f]===b||c[f].listener&&c[f].listener===b){d=f;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},EventEmitter.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],isFunction(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},EventEmitter.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?isFunction(this._events[a])?[this._events[a]]:this._events[a].slice():[]},EventEmitter.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?isFunction(a._events[b])?1:a._events[b].length:0};